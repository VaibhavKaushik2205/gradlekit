# 🔧 Modifying a Shaded JAR File to Remove Specific Dependencies

This guide outlines how to **manually modify a Shaded JAR file** by extracting its contents, removing specific (potentially vulnerable) dependencies, and repackaging it.
This process can be done manually or automating the process via a gradle task. 
---

## 📦 Steps to Remove any shaded

### 1. Download the JAR

Use `wget` or download the JAR manually.

```bash
wget <URL-to-specific-jar>
```

### 2. Extract the JAR Contents
e.g
```bash
jar xf <jar-name>.jar
```

This will extract the contents into the current directory.

### 3. Locate Unwanted Dependencies

Find dependencies you want to remove:

```bash
find . -name "*<shaded-package>*"
```

### 4. Remove the Dependencies

Delete the identified files or directories:

```bash
rm -rf path/to/unwanted/files
```

### 5. Repackage the JAR

Once cleaned, repackage it:

```bash
jar cf <jar-name>.jar .
```

### 6. Use the Modified JAR

Reference it as a flat file dependency in your `build.gradle`:

```groovy
dependencies {
    implementation files('<jar-name>.jar')
}
```

---

## ⚙️ Automating It with a Gradle Task

Instead of manually modifying a JAR, you can automate the process using a Gradle task: `customizeJar`.

### 🔧 How It Works

The task:

- Downloads the specified JARs
- Extracts them
- Removes unwanted shaded dependencies (e.g., `avro`)
- Repackages the cleaned JARs
- Stores them in `customJar/libs/` for consumption (or any custom path)

---

### 🛠 Setup Instructions

#### 1. Define Your Dependency Config

In your module's `build.gradle`, add a top-level `ext.dependencyConfigs` block specifying what to clean:

```groovy
// Provide the required jars and the vulnerable shaded package(s) to remove
ext.dependencyConfigs = [
    "org.apache.hadoop:hadoop-client-runtime:3.4.1": [
        exclude: ['avro'],
    ],
]
```

#### 2. Run the Task
From the root of your project, run:

```bash
./gradlew :vulnerability-removal:customizeJar
```

##### This will create cleaned JAR(s) under:

```bash
vulnerability-removal/customJar/libs/  (or any custom path)
```

## ✅ Optional: Verify the Result
You can manually check that the cleaned JAR does not include the excluded packages:

```bash
jar tf customJar/libs/hadoop-client-runtime-3.4.1.jar | grep avro
```

## 📝 Notes

- Use this technique when you **cannot exclude** vulnerable or unneeded dependencies using standard Gradle mechanisms.
- Always verify the **integrity and functionality** of the modified JAR before using it.
- Prefer using **Gradle or Maven dependency management** for maintainability.
- This process is best used for temporary workarounds when vulnerable shaded dependencies cannot be excluded via standard dependency resolution.

## 📚 Example Use Case

You might want to do this if:

- You're using an older shaded JAR (like Hadoop) having shaded packages like Avro having known CVE.
- You want to slim down the size of a fat JAR in embedded environments.